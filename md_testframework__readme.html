<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>My Project: Test framework</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="class_test.html">Test</a> framework </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Background</h2>
<p>This is a frame work for writing unit tests for modules or libs. It compiles only src/libs/... and a few select needed modules by default. It runs on the target and the output is written to the serial UART, it runs well with MRI so you can also debug with GDB.</p>
<p>You can edit a file to specify which module you are going to test by default the example has tools/temperaturecontrol selected.</p>
<p>The unit tests go in a directory named src/testframework/unittests/*XXXX*/*YYYY* where <em>XXXX</em> is the module subdirectory (tools,utils) and <em>YYYY</em> is the modulename</p>
<p>The <a class="el" href="class_kernel.html">Kernel</a> and main are replaced with special versions for testing.</p>
<p>The main way to test is to stimulate the modules by sending it commands via on_gcode_received() (or other events it is registered for), and monitor its actions my mocking the ON_PUBLIC_SET/GET calls it makes. A properly written module does not access other modules any other way.</p>
<p>Many HAL calls are made via THEKERNEL-&gt;xxx (eg THEKERNEL-&gt;adc) and these can be intercepted by mocks to provide the module with its external data.</p>
<p>An example is provided here...</p>
<p><code>src/testframework/unittests/tools/temperatureswitch/TEST_TemperatureSwitch.cpp</code></p>
<h2>Usage</h2>
<p>You compile a unit test and framework using <a href="http://rake.rubyforge.org/">rake</a>...</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&gt; rake testing=1</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&gt; rake upload</div>
</div><!-- fragment --><p>The unit test will run, the results are printed to the serial uart port, and then it is left in <a class="el" href="class_d_f_u.html">DFU</a> mode so <code>rake upload</code> can be run again for the next test.</p>
<p>You select which tests and modules you want to compile by creating a file called rakefile.defaults in the same directory as the Rakefile is found.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;TESTMODULES= %w(tools/temperatureswitch libs)</div>
</div><!-- fragment --><p>Here we enable unit tests for the tools/temperatureswitch module and any unit tests in src/testframework/unittests/tools/temperatureswitch/. Also any unittests in the src/testframework/unittests/libs folder will be included</p>
<p>In this case all files in src/libs/... are compiled anyway so we only need to enable unit tests in the src/testframework/unittests/libs folder.</p>
<p>the tools/temperatureswitch both compiles all files in the src/modules/tools/temperatureswitch/... directory and enables the unit tests in src/testframework/unittests/tools/temperatureswitch/...</p>
<p>by default no other files in the src/modules/... directory tree are compiled unless specified above. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
